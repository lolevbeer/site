name: Update Data
on:
  push:
    branches:
      - master
  repository_dispatch:
    types: [update-data]
  workflow_dispatch:  # Allows manual triggering

jobs:
  get-remote-doc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.2.2
        with:
          token: ${{ github.token }}
      - name: Get Remote Document
        continue-on-error: true
        run: |
          cd _data
          wget -O lawrenceville-draft.csv ${{ vars.LAWRENCEVILLE_DRAFT }}
          wget -O lawrenceville-cans.csv ${{ vars.LAWRENCEVILLE_CANS }}
          wget -O lawrenceville-food.csv ${{ vars.LAWRENCEVILLE_FOOD }}
          wget -O lawrenceville-events.csv ${{ vars.LAWRENCEVILLE_EVENTS }}
          wget -O lawrenceville-hours.csv ${{ vars.LAWRENCEVILLE_HOURS }}
          wget -O zelienople-draft.csv ${{ vars.ZELIENOPLE_DRAFT }}
          wget -O zelienople-cans.csv ${{ vars.ZELIENOPLE_CANS }}
          wget -O zelienople-food.csv ${{ vars.ZELIENOPLE_FOOD }}
          wget -O zelienople-events.csv ${{ vars.ZELIENOPLE_EVENTS }}
          wget -O zelienople-hours.csv ${{ vars.ZELIENOPLE_HOURS }}
          wget -O beer.csv ${{ vars.BEER }}
          wget -O coming.csv ${{ secrets.COMING_GSHEET }}

          cd ..
          git config --local user.email "lolevbeer@gmail.com"
          git config --local user.name "Lolev Manager"
          git add _data/*.csv
          git diff-index --quiet HEAD -- _data/*.csv || git commit -m "Sync Data from google sheets"
          git push
